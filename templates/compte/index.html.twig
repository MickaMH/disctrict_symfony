{% extends 'base.html.twig' %}

{% block title %}Espace compte{% endblock %}

{% block body %}
{% for message in app.flashes('success') %}
    <div class="alert alert-success">{{ message }}</div>
{% endfor %}
{% for message in app.flashes('error') %}
    <div class="alert alert-danger">{{ message }}</div>
{% endfor %}
{# MAIN #}
<main class="container-fluid pb-lg-5">

    {# EN-TETE COMPTE #}
    <div class="row d-flex justify-content-center">

        <div class="col-sm-10 col-lg-3 fs-1 fw-medium mb-lg-3 mt-3 mt-lg-3 text-center">

            <p>ESPACE COMPTE</p>

        </div>

    </div>

    <div class="row">

        <p class="d-block d-md-none liens_header_bonjour fs-2 fw-medium">Bonjour <span class="lettres">{{ app.user.prenom }}<span></p>

    </div>

    <div class="row d-flex justify-content-around mb-5 mt-lg-5">

        <div class="accordion col-lg-7" id="accordionExample">

            {% if 'ROLE_ADMIN' in app.user.roles or 'ROLE_CHEF' in app.user.roles %}
            {# ACCES ADMIN #}
            <div class="accordion-item bordures_accordion">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed fs-3 fw-medium" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                        Administration du site
                    </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <a class="nav-link liens_header fs-3 fw-medium" href="{{ path('admin') }}">→ Accéder au tableau de bord</a>
                    </div>
                </div>
            </div>
            {% endif %}

            {# INFOS PERSONNELLES #}
            <div class="accordion-item bordures_accordion">

                <h2 class="accordion-header">
                    <button class="accordion-button collapsed fs-3 fw-medium" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                        Informations personnelles
                    </button>
                </h2>

                <div id="collapseTwo" class="accordion-collapse collapse col-lg-12" data-bs-parent="#accordionExample">

                    <div class="accordion-body d-flex flex-column fs-4">

                        {# INFOS DESKTOP #}
                        <div class="d-none d-lg-block">
                        <table class="table">
                            <tbody class="fs-4">
                                <tr class="border_historique">
                                    <td class="col-lg-4 fw-medium">
                                        Nom :
                                    </td>
                                    <td class="col-lg-8">
                                        {{ app.user.nom }}
                                    </td>
                                </tr>
                                <tr class="border_historique">
                                    <td class="fw-medium">
                                        Prénom :
                                    </td>
                                    <td>
                                        {{ app.user.prenom }}
                                    </td>
                                </tr>
                                <tr class="border_historique">
                                    <td class="fw-medium">
                                        Téléphone :
                                    </td>
                                    <td>
                                        {{ app.user.telephone }}
                                    </td>
                                </tr>
                                <tr class="border_historique">
                                    <td class="fw-medium">
                                        Adresse :
                                    </td>
                                    <td>
                                        {{ app.user.adresse }}
                                    </td>
                                </tr>
                                <tr class="border_historique">
                                    <td class="fw-medium">
                                        Code postal :
                                    </td>
                                    <td>
                                        {{ app.user.cp }}
                                    </td>
                                </tr>
                                <tr class="border_historique">
                                    <td class="fw-medium">
                                        Ville :
                                    </td>
                                    <td>
                                        {{ app.user.ville }}
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        </div>

                        {# INFOS MOBILE #}
                        <div class="d-block d-sm-none">
                        <table class="table">
                            <tbody class="fs-4 border border-white">

                                <tr>
                                    <td class="fw-medium">
                                        Nom :
                                    </td>
                                </tr>
                                <tr class="border_historique">
                                    <td class="">
                                        {{ app.user.nom }}
                                    </td>
                                </tr>

                                <tr>
                                    <td class="fw-medium">
                                        Prénom :
                                    </td>
                                </tr>
                                <tr class="border_historique">
                                    <td>
                                        {{ app.user.prenom }}
                                    </td>
                                </tr>

                                <tr>
                                    <td class="fw-medium">
                                        Téléphone :
                                    </td>
                                </tr>
                                <tr class="border_historique">
                                    <td>
                                        {{ app.user.telephone }}
                                    </td>
                                </tr>

                                <tr>
                                    <td class="fw-medium">
                                        Adresse :
                                    </td>
                                </tr>
                                <tr class="border_historique">
                                    <td>
                                        {{ app.user.adresse }}
                                    </td>
                                </tr>

                                <tr>
                                    <td class="fw-medium">
                                        Code postal :
                                    </td>
                                </tr>
                                <tr class="border_historique">
                                    <td>
                                        {{ app.user.cp }}
                                    </td>
                                </tr>

                                <tr>
                                    <td class="fw-medium">
                                        Ville :
                                    </td>
                                </tr>
                                <tr class="border_historique">
                                    <td>
                                        {{ app.user.ville }}
                                    </td>
                                </tr>

                            </tbody>
                        </table>
                        </div>

                        <div class="mt-3">

                            <p class="fs-4">Vous pouvez modifier vos informations personnelles ci-dessous :</p>

                            <a href="{{ path('app_modif_infos') }}"
                                class="mb-3 mx-auto d-flex justify-content-center align-items-center fw-medium shadow-lg fs-5 rounded-3 bouton_envoyer"
                                style="width: 15rem; height: 3rem;">
                                Modifier
                            </a>

                        </div>

                    </div>

                </div>
                
            </div>

            {# HISTORIQUE COMMANDES #}
            <div class="accordion-item bordures_accordion">

                <h2 class="accordion-header">
                    <button class="accordion-button collapsed fs-3 fw-medium" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                        Historique des commandes
                    </button>
                </h2>

                <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                    
                    <div class="accordion-body">
                        {% for commande in commandes %}

                        <!-- Button trigger modal -->
                        <button type="button" class="col-12 modal_bouton" data-bs-toggle="modal" data-bs-target="#exampleModal-{{ loop.index }}">
                            <div class="fs-4 border_historique mt-2 text-start">
                                <p>Commande n° <span class="fw-medium">{{ commande.commande.id }}</span><br class="d-block d-sm-none"> du <span class="fw-medium">{{ commande.commande.dateCommande|date('d/m/Y') }}</span></p>
                            </div>
                        </button>

                        <!-- Modal -->
                        <div class="modal fade" id="exampleModal-{{ loop.index }}" tabindex="-1" aria-labelledby="exampleModalLabel-{{ loop.index }}" aria-hidden="true">

                            {# DETAILS DESKTOP #}
                            <div class="d-none d-lg-block">
                                
                                <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">

                                    <div class="modal-content">

                                        <div class="modal-header border_thead">

                                            <h1 class="modal-title fs-2 fw-bold" id="exampleModalLabel-{{ loop.index }}">

                                                Commande n° {{ commande.commande.id }} du {{ commande.commande.dateCommande|date('d/m/Y') }} 

                                                <span class="ms-5">
                                                {% if commande.commande.etat == 0 %}
                                                Enregistrée
                                                {% elseif commande.commande.etat == 1 %}
                                                Préparation
                                                {% elseif commande.commande.etat == 2 %}
                                                Livraison
                                                {% elseif commande.commande.etat == 3 %}
                                                Livrée <span class="text-success fw-bold">&#x2713;</span>
                                                {% else %}
                                                État inconnu
                                                {% endif %}
                                                </span>

                                            </h1>

                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>

                                        </div>

                                        <div class="modal-body fs-4">

                                            <p class="fs-3 fw-bold">Détails de la commande</p>

                                            <table class="table">

                                                <tbody class="fs-4 border_historique">
                                                    {% for detail in commande.details %}
                                                    <tr class="fw-medium">
                                                        <td>{{ detail.plat.libelle }}</td>
                                                        <td>Prix unit.</td>
                                                        <td>Quantité</td>
                                                        <td>Sous-total</td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            <img src="/images/plats/{{ detail.plat.image }}" class="img-fluid m-3 rounded-4 border_image" style="width: 8rem; height: 8rem;" alt="{{ detail.plat.libelle }}" title="{{ detail.plat.libelle }}">
                                                        </td>
                                                        <td class="">{{ detail.plat.prix }} €</td>
                                                        <td>{{ detail.quantite }}</td>
                                                        <td class="fw-medium">{{ detail.plat.prix * detail.quantite }}.00 €</td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>

                                                <tfoot>
                                                    <tr>
                                                        <td colspan="3" class="fs-3 fw-bold">Total de la commande</td>
                                                        <td class="fw-bold">{{ commande.commande.total }} €</td>
                                                    </tr>
                                                </tfoot>

                                            </table>

                                        </div>

                                        <div class="modal-footer">
                                            <button type="button" class="d-flex justify-content-center align-items-center fw-medium shadow-lg fs-4 me-5 bouton_fermer_panier" data-bs-dismiss="modal">Fermer</button>
                                        </div>

                                    </div>
                                </div>

                            </div>

                            {# DETAILS MOBiLE #}
                            <div class="d-block d-sm-none">

                                <div class="modal-dialog modal-dialog-scrollable">

                                    <div class="modal-content">

                                        <div class="modal-header border_thead">

                                            <h1 class="modal-title fs-3 fw-bold" id="exampleModalLabel-{{ loop.index }}">
                                                Commande n° {{ commande.commande.id }}
                                                <br>
                                                du {{ commande.commande.dateCommande|date('d/m/Y') }}
                                                <br>
                                                <span class="text text-success">
                                                    Livrée &#10003;
                                                </span>
                                            </h1>

                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>

                                        </div>

                                        <div class="modal-body fs-4">

                                            <p class="fs-4 fw-bold">Détails de la commande</p>

                                            <table class="table">

                                                <thead class="fs-4 border_historique">

                                                    <tr>

                                                        <th>Plat</th>

                                                    </tr>

                                                </thead>

                                                <tbody class="fs-6">
                                                    {% for detail in commande.details %}

                                                    <tr>
                                                        <td>

                                                            <div class="fw-medium">

                                                                <p class="my-auto">{{ detail.plat.libelle }}</p>

                                                            </div>

                                                        </td>

                                                    </tr>

                                                    <tr>
                                                        <td class="d-flex">

                                                            <div>

                                                                <img src="/images/plats/{{ detail.plat.image }}" class="img-fluid rounded-4 border_image" style="width: 7rem; height: 7rem;" alt="{{ detail.plat.libelle }}" title="{{ detail.plat.libelle }}">

                                                            </div>

                                                            <div class="ms-2 d-flex flex-column">

                                                                    <p>Prix: {{ detail.plat.prix }} €</p>

                                                                    <p>Quantité: {{ detail.quantite }}</p>

                                                                    <p class="fw-medium">Total: {{ detail.plat.prix * detail.quantite }}.00 €</p>

                                                            </div>

                                                        </td>
                                                    </tr>

                                                    {% endfor %}
                                                </tbody>

                                                <tfoot class="border_top">
                                                    <tr>
                                                        <td class="fs-4 fw-bold">
                                                            <p>Total commande: {{ commande.commande.total }} €</p>
                                                        </td>
                                                    </tr>
                                                </tfoot>

                                            </table>

                                        </div>

                                        <div class="modal-footer mx-auto">
                                            <button type="button" class="d-flex justify-content-center align-items-center fw-medium shadow-lg fs-5 bouton_fermer_panier" data-bs-dismiss="modal">Fermer</button>
                                        </div>

                                    </div>

                                </div>

                            </div>

                        </div>
                        {% endfor %}

                    </div>

                </div>

            </div>

            {# IDENTIFIANTS #}
            <div class="accordion-item bordures_accordion">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed fs-3 fw-medium" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                        Identifiants de connexion
                    </button>
                </h2>
                <div id="collapseFour" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                    <div class="accordion-body">

                        <p class="fs-3 fw-medium mt-2">Email</p>

                        <p class="fs-4 mt-2">Vous pouvez modifier votre adresse email ci-dessous :</p>

                        <p class="fs-3 fw-medium mt-2">Mot de passe</p>

                        <p class="fs-4 mt-2">Vous pouvez modifier votre mot de passe ci-dessous :</p>

                        <form action="{{ path('app_compte_changer_mot_de_passe') }}" method="post" class="col-sm-10 col-lg-5 mt-3 mt-lg-0 mb-lg-5 fs-4 d-flex flex-column mx-auto">

                            <label for="old_password">Ancien mot de passe</label>
                            <input type="password" id="old_password" name="old_password" class="form-control fs-4 border-3 bordures fond_input">

                            <label for="new_password">Nouveau mot de passe</label>
                            <input type="password" id="new_password" name="new_password" class="form-control fs-4 border-3 bordures fond_input">

                            <label for="confirm_new_password">Confirmer le nouveau mot de passe</label>
                            <input type="password" id="confirm_new_password" name="confirm_new_password" class="form-control fs-4 border-3 bordures fond_input">

                            <button type="submit" class="mt-3 mb-3 d-flex justify-content-center align-items-center mx-auto fw-medium shadow-lg fs-5 rounded-3 bouton_envoyer"
                                style="width: 15rem; height: 3rem;">Modifier</button>

                        </form>

                    </div>
                </div>
            </div>

            {# SUPPRIMER LE COMPTE #}
            <div class="accordion-item bordures_accordion">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed fs-3 fw-medium" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
                        Suppression du compte
                    </button>
                </h2>
                <div id="collapseFive" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                    <div class="accordion-body">

                        <p class="fs-4 mt-2">Vous pouvez supprimer votre compte ci-dessous :</p>

                        <a href="{{ path('app_compte_supprimer') }}"
                            class="mb-3 d-flex justify-content-center align-items-center mx-auto fw-medium shadow-lg fs-5 rounded-3 bouton_envoyer"
                            style="width: 15rem; height: 3rem;">
                            Supprimer
                        </a>

                    </div>
                </div>
            </div>

        </div>

    </div>

    {# BOUTON SE DECONNECTER #}
    <div class="row mt-5 mb-5">

        <div class="col-sm-12 col-lg-12 d-flex justify-content-center">

            <a class="d-flex justify-content-center align-items-center fw-medium mx-auto shadow-lg fs-5 rounded-3 bouton_categories"
                style="width: 15rem; height: 3rem;" href="{{ path('app_logout') }}" role="button">Se déconnecter</a>

        </div>

    </div>

</main>
{% endblock %}
